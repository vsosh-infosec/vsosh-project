




rule SuspiciousStrings {
    meta:
        description = "Detects common suspicious strings"
        score = 10
        mitre = "T1059"
    strings:
        $cmd1 = "cmd.exe" nocase
        $cmd2 = "/bin/sh" nocase
        $cmd3 = "/bin/bash" nocase
        $ps1 = "powershell" nocase
        $wget = "wget " nocase
        $curl = "curl " nocase
    condition:
        any of them
}

rule NetworkIndicators {
    meta:
        description = "Network-related suspicious patterns"
        score = 15
        mitre = "T1071"
    strings:
        $socket = "socket" nocase
        $connect = "connect" nocase
        $http = "http://" nocase
        $https = "https://" nocase
        $telegram = "api.telegram.org"
        $discord = "discord.com/api"
    condition:
        2 of them
}

rule CryptoMining {
    meta:
        description = "Cryptocurrency mining indicators"
        score = 25
        mitre = "T1496"
    strings:
        $pool1 = "stratum+tcp://"
        $pool2 = "pool.minergate"
        $pool3 = "xmrig"
        $wallet = /[13][a-km-zA-HJ-NP-Z1-9]{25,34}/
    condition:
        any of them
}

rule Ransomware {
    meta:
        description = "Ransomware indicators"
        score = 30
        mitre = "T1486"
    strings:
        $ransom1 = "your files have been encrypted" nocase
        $ransom2 = "bitcoin" nocase
        $ransom3 = ".onion" nocase
        $ext1 = ".locked"
        $ext2 = ".encrypted"
        $ext3 = ".crypted"
    condition:
        2 of them
}

rule ProcessInjection {
    meta:
        description = "Process injection techniques"
        score = 20
        mitre = "T1055"
    strings:
        $ptrace = "ptrace" nocase
        $memfd = "memfd_create"
        $proc_mem = "/proc/self/mem"
        $ld_preload = "LD_PRELOAD"
    condition:
        any of them
}

rule PrivilegeEscalation {
    meta:
        description = "Privilege escalation attempts"
        score = 25
        mitre = "T1548"
    strings:
        $setuid = "setuid" nocase
        $setgid = "setgid" nocase
        $sudo = "sudo " nocase
        $su = "su " nocase
        $shadow = "/etc/shadow"
        $passwd = "/etc/passwd"
    condition:
        2 of them
}

rule PersistenceMechanisms {
    meta:
        description = "Persistence indicators"
        score = 20
        mitre = "T1547"
    strings:
        $cron = "crontab" nocase
        $bashrc = ".bashrc"
        $profile = ".profile"
        $systemd = ".service"
        $init = "/etc/init.d"
        $rc_local = "/etc/rc.local"
    condition:
        any of them
}

rule DataExfiltration {
    meta:
        description = "Data exfiltration indicators"
        score = 20
        mitre = "T1041"
    strings:
        $base64 = "base64" nocase
        $zip = "zip " nocase
        $tar = "tar " nocase
        $scp = "scp " nocase
        $ftp = "ftp " nocase
    condition:
        2 of them
}

rule ShellcodePatterns {
    meta:
        description = "Common shellcode patterns (requires multiple indicators)"
        score = 15
        mitre = "T1059.004"
    strings:
        $nop = { 90 90 90 90 90 90 }
        $xor_eax = { 31 c0 }
        $xor_eax2 = { 33 c0 }
        $syscall = { 0f 05 }
        $int80 = { cd 80 }
        $shellcode_push = { 68 ?? ?? ?? ?? }
    condition:
        ($nop) or (3 of ($xor*, $syscall, $int80, $shellcode_push))
}

rule ObfuscatedScript {
    meta:
        description = "Obfuscated script patterns"
        score = 15
        mitre = "T1027"
    strings:
        $eval = "eval(" nocase
        $exec = "exec(" nocase
        $compile = "compile(" nocase
        $chr = "chr(" nocase
        $fromcharcode = "fromCharCode" nocase
    condition:
        2 of them
}
